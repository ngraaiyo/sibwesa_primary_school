{% extends 'base.html' %}
{% load static %}

{% block title %}Login - Sibwesa Primary School{% endblock %}
{% block dashboard_css %}{% endblock dashboard_css %}
{% block extra_head %}
{# You commented out forms.css. If you have other form styling there, you might want to uncomment it #}
{# <link rel="stylesheet" href="{% static 'users/css/forms.css' %}"> #}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="{% static 'users/css/login_styles.css' %}">
{% endblock %}

{% block body_content %}
<div class="main-content-wrapper">
    <div class="card transparent-card">
       <div class="card-header bg-primary text-white text-center py-3 shadow-sm">
            <h3 class="mb-0 fw-bold">
                <i class="bi bi-mortarboard-fill me-2"></i>
                Login to <span class="text-warning">Sibwesa Primary School</span>
            </h3>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                {% if form.non_field_errors %}
                    <div class="alert alert-danger mt-3">
                        {% for error in form.non_field_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
                {% for field in form %}
                    <div class="mb-3">
                        {{ field.label_tag }} {# The label should be separate #}

                        {# --- THIS IS THE CRITICAL HTML WRAPPER FOR ICON INSIDE FIELD --- #}
                        <div class="input-group-field"> {# This div needs to wrap BOTH the icon and the input #}
                            {% if field.name == 'username' %}
                                <i class="fas fa-user icon-in-field"></i> {# Icon is here #}
                            {% elif field.name == 'password' %}
                                <i class="fas fa-lock icon-in-field"></i> {# Icon is here #}
                            {% endif %}
                            
                            {# The actual input field comes immediately after the icon within this div #}
                            {% if field.field.widget.input_type == 'password' %}
                                <input type="password" 
                                            name="{{ field.name }}" 
                                            id="{{ field.id_for_label }}" 
                                            class="form-control" 
                                            {% if field.value %}value="{{ field.value }}"{% endif %}
                                            {% if field.field.required %}required{% endif %}
                                            {% for name, value in field.field.widget.attrs.items %}{{ name }}="{{ value }}" {% endfor %}>
                            {% else %}
                                <input type="{{ field.field.widget.input_type }}" 
                                            name="{{ field.name }}" 
                                            id="{{ field.id_for_label }}" 
                                            class="form-control" 
                                            value="{{ field.value|default_if_none:'' }}"
                                            {% if field.field.required %}required{% endif %}
                                            {% for name, value in field.field.widget.attrs.items %}{{ name }}="{{ value }}" {% endfor %}>
                            {% endif %}
                        </div> {# End of input-group-field wrapper #}
                        {# --- END OF CRITICAL HTML WRAPPER --- #}

                        {% if field.help_text %}
                            <small class="form-text text-muted">{{ field.help_text }}</small>
                        {% endif %}
                        {% for error in field.errors %}
                            <div class="alert alert-danger mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endfor %}
               <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-sign-in-alt"></i>
                    Login
                </button>
            </form>
            <p class="mt-3 text-center">Don't have an account? <a href="{% url 'register' %}">Register here</a></p>
            <p class="mt-1 text-center">
                <a href="{% url 'password_reset' %}">Forgot your password?</a>
            </p>
        </div>
    </div>
</div>
{% endblock body_content %}