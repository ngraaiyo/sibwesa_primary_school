{% extends 'base.html' %}

{% block title %}Result Slip - {{ student.get_full_name }} - Sibwesa Primary School{% endblock %}

{% block content %}
<div class="container-fluid mb-4 mt-4 print-area">
    <div class="card shadow-lg border-0">
        <div class="card-header bg-primary text-white text-center">
            <h4 class="mb-0"><i class="bi bi-building"></i> Sibwesa Primary School</h4>
            <h5 class="mb-0"><i class="bi bi-journal-check"></i> Result Slip - {{ examination.name }} ({{ examination.get_term_display }} - {{ examination.academic_year }})</h5>
        </div>
        <div class="card-body">
            <div class="row mb-4">
                <div class="col-md-6">
                    <p><i class="bi bi-person-circle"></i> <strong>Student Name:</strong> {{ student.get_full_name }}</p>
                    <p><i class="bi bi-123"></i> <strong>Admission No.:</strong> {{ student.admission_number }}</p>
                    <p><i class="bi bi-easel2"></i> <strong>Class:</strong> {{ student.current_class.name }} (Standard {{ student.current_class.year }})</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p>
                        <i class="bi bi-trophy-fill"></i> 
                        <strong>Overall Position:</strong>
                        {% if student_result.position %}
                            <span class="display-6 fw-bold text-primary">
                                {{ student_result.position }}<sup>
                                    {% if student_result.position|slice:"-1" == "1" and not student_result.position|slice:"-2" == "11" %}
                                        st
                                    {% elif student_result.position|slice:"-1" == "2" and not student_result.position|slice:"-2" == "12" %}
                                        nd
                                    {% elif student_result.position|slice:"-1" == "3" and not student_result.position|slice:"-2" == "13" %}
                                        rd
                                    {% else %}
                                        th
                                    {% endif %}
                                </sup>
                            </span>
                        {% else %}
                            <span class="badge bg-secondary">N/A</span>
                        {% endif %}
                    </p>
                    <p><i class="bi bi-bar-chart-line"></i> <strong>Total Score:</strong> {{ student_result.total_score }}</p>
                    <p><i class="bi bi-graph-up-arrow"></i> <strong>Average Score:</strong> <span class="badge bg-success fs-6">{{ student_result.average_score }}</span></p>
                    <p><i class="bi bi-award"></i> <strong>Overall Grade:</strong> <span class="badge bg-info fs-6">{{ student_result.overall_grade }}</span></p>
                </div>
            </div>

            <hr>
            <h5 class="mb-3"><i class="bi bi-book-half"></i> Subject-wise Performance</h5>
            {% if student_result.subject_details %}
                <div class="table-responsive">
                    <table class="table table-bordered table-hover table-striped align-middle">
                        <thead class="table-dark text-center">
                            <tr>
                                <th><i class="bi bi-book"></i> Subject</th>
                                <th><i class="bi bi-bar-chart"></i> Score</th>
                                <th><i class="bi bi-award-fill"></i> Grade</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for detail in student_result.subject_details %}
                            <tr class="text-center">
                                <td class="text-start">{{ detail.subject_name }}</td>

                                <td>{{ detail.score|default_if_none:"N/A" }}</td>
                                <td>{{ detail.grade }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-warning">No subject marks recorded for this student in this examination.</div>
            {% endif %}

            <hr>
            <div class="mb-3">
                <strong><i class="bi bi-person-fill-check"></i> Class Teacher:</strong> 
                {{ student_result.class_teacher.get_full_name|default:"N/A" }}
            </div>

            <div class="mb-3">
                <strong><i class="bi bi-person-fill-check"></i> Class Teacher's Comment:</strong> ____________________________________________________________________________
            </div>
            <div class="mb-3">
                <strong><i class="bi bi-person-fill-check"></i> Head Teacher:</strong> 
                {{ student_result.head_teacher.get_full_name|default:"N/A" }}
            </div>
            <div class="mb-3">
                <strong><i class="bi bi-person-fill-check"></i> Head Teacher's Comment:</strong> ____________________________________________________________________________
            </div>

            <div class="d-flex justify-content-between align-items-center mt-4">
                <a href="{% url 'class_summary_pdf' exam_id=examination.pk class_id=student.current_class.pk %}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left-circle"></i> Back to Class Summary
                </a>
                
                <a href="{% url 'student_result_pdf' exam_id=examination.pk student_id=student.pk %}" class="btn btn-info d-print-none" target="_blank">
                    <i class="bi bi-printer"></i> Print Result Slip
                </a>
                
                <a href="{% url 'student_result_pdf' exam_id=examination.pk student_id=student.pk %}?download=true" class="btn btn-success d-print-none">
                    <i class="bi bi-file-earmark-pdf"></i> Download PDF
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<style>
    @media print {
        body * {
            visibility: hidden;
        }
        .print-area, .print-area * {
            visibility: visible;
        }
        .btn,
        .d-print-none,
        nav,
        footer {
            display: none !important;
        }
        .card-header {
            background-color: #ffffff !important;
            color: #000 !important;
        }
        @page {
            size: A4;
            margin: 20mm;
        }
        .card {
            border: none;
            box-shadow: none;
            width: 100%;
        }
        body {
            font-family: Arial, sans-serif;
        }
    }

    .badge {
        padding: 0.4em 0.6em;
        font-weight: 600;
    }

    .card-body p {
        margin-bottom: 0.5rem;
    }
</style>
{% endblock %}

{% block extra_js %}
<!-- If Font Awesome is no longer needed, you can remove this -->
{% endblock %}
