{% extends 'base.html' %}

{% block title %}Mark Entry - Kabage Primary School{% endblock %}

{% block extra_css %}
<style>
    .table thead th {
        font-weight: bold;
        text-transform: uppercase;
        font-size: 0.9em;
        vertical-align: middle;
    }
    .table tbody td {
        vertical-align: middle;
        padding: 0.5rem 0.75rem;
    }
    .table input[type="number"] {
        width: 90px;
        text-align: center;
        padding: 0.4rem 0.5rem;
        background-color: #f8f9fa; /* Light gray background */
        border: 1px solid #ced4da;
        border-radius: 0.4rem;
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.075);
        transition: all 0.3s ease;
        font-weight: 500;
    }

    .table input[type="number"]:focus {
        border-color: #86b7fe;
        outline: 0;
        box-shadow: 0 0 0 0.15rem rgba(13, 110, 253, 0.25);
        background-color: #fff;
    }

    .score-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .score-label i {
        color: #0d6efd;
        font-size: 1rem;
    }

    .table td .alert-danger {
        font-size: 0.8rem;
        padding: 0.25rem 0.5rem;
        margin-top: 0.2rem;
    }

    .table-responsive {
        border: 1px solid #dee2e6;
        border-radius: 0.4rem;
        overflow: hidden;
    }
    .form-error {
        font-size: 0.875em;
        color: #dc3545;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4"><i class="bi bi-pencil-square me-2"></i>Enter Marks</h1>
    <a href="{% url 'mark_entry_selection' %}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left-circle me-1"></i>Back to Selection
    </a>
</div>

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            <i class="bi bi-info-circle-fill me-1"></i>{{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
{% endif %}

<div class="alert alert-info d-flex align-items-center small py-2 px-3 mb-3 shadow-sm" role="alert">
    <div class="row w-100 g-2 align-items-center">
        <div class="col-md-4 col-sm-6">
            <i class="bi bi-ui-checks-grid me-1 text-primary"></i>
            <strong>Examination:</strong> {{ examination.name }} 
            ({{ examination.get_term_display }} - {{ examination.academic_year }})
        </div>
        <div class="col-md-4 col-sm-6">
            <i class="bi bi-journal-text me-1 text-primary"></i>
            <strong>Subject:</strong> {{ subject.name }} ({{ subject.code }})
        </div>
        <div class="col-md-4 col-sm-12">
            <i class="bi bi-building me-1 text-primary"></i>
            {% if selected_class %}
                <strong>Class:</strong> {{ selected_class.name }} ({{ selected_class.year }})
            {% else %}
                <strong>Class:</strong> All Classes (Academic Teacher/Admin View)
            {% endif %}
        </div>
    </div>
</div>
<form method="post" novalidate>
    {% csrf_token %}
    <div class="table-responsive shadow-sm">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>#</th>
                    <th><i class="bi bi-hash"></i> Prem No.</th>
                    <th><i class="bi bi-person"></i> Student Name</th>
                    <th><i class="bi bi-clipboard-check"></i> Score (0-100)</th>
                </tr>
            </thead>
            <tbody>
                {{ formset.management_form }}
                {% for form in formset %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ form.instance.student.prem_number }}</td>
                    <td>{{ form.instance.student.get_full_name }}</td>
                    <td>
                        {{ form.score }}
                        {% if form.instance.pk %}
                            <input type="hidden" name="{{ form.prefix }}-id" value="{{ form.instance.pk }}">
                        {% endif %}
                        {% if form.score.errors %}
                            <div class="form-error mt-1">
                                <i class="bi bi-exclamation-circle me-1"></i>{{ form.score.errors.0 }}
                            </div>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center text-muted">No students found for mark entry.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="d-flex justify-content-end mt-4">
        <button type="submit" class="btn btn-success px-4">
            <i class="bi bi-save2 me-1"></i> Save All Marks
        </button>
    </div>
</form>
{% endblock %}
